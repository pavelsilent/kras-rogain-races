<h3 class="header" *ngIf="format as raceFormat">
  <div class="header-container">
    <span>{{ raceFormat.raceName }}</span>
    <br>
    <span>{{ raceFormat.name }}</span>
    <br>
    <span>{{ (raceFormat.startDateTime | toRusDateTime) }}</span>
    <br><span>{{ raceFormat.state.name }}</span>
    <div class="race-action" *ngIf="page.canEdit() | async as canEdit">
      <!--      <button *ngIf="raceFormat.state != states.STARTED && raceFormat.state != states.FINISHED"-->
      <button *ngIf="raceFormat.state != raceStates.STARTED"
              mat-flat-button
              color="primary"
              (click)="onSetRaceState(raceStates.STARTED)">Начать гонку
      </button>
      <button *ngIf="raceFormat.state == raceStates.STARTED"
              mat-flat-button
              color="primary"
              (click)="onSetRaceState(raceStates.FINISHED)">Завершить гонку
      </button>
    </div>
  </div>
</h3>

<div class="table-wrapper">
  <table mat-table [dataSource]="membersDataSource" class="protocol-table">
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef class="center bold">Участник</th>
      <td mat-cell *matCellDef="let row" (click)="onShowAthleteDetailInfo(row)"
          [ngClass]="{'finished': row.isFinished(), 'disqualified': row.isDisqualified() }">
        <div class="athlete-data-container">
          <div class="athlete-data-time bold">
            <span class="athlete-data-name">{{ row.athlete.getShortFIO() }}
              <mat-icon *ngIf="page.canEdit() | async" (click)="$event.stopPropagation(); onAddAthleteCheckPoint(row)">add</mat-icon>
              <mat-icon *ngIf="page.canEdit() | async"
                        (click)="$event.stopPropagation(); onSetAthleteState(row)">edit</mat-icon>
            </span>
            <span>{{ 'Номер: ' + row.bibNumber }}</span>
          </div>
          <div class="athlete-data-time">
            <div>
                <span *ngIf="row?.lastRaceAthleteCheckPoint" class="bold"
                      [ngClass]="{'check-time-expired': getCheckPointTimeExpired(row)}">
                  {{ row?.lastRaceAthleteCheckPoint.raceTime | toRusTime }}
                </span>
              <br>
              <span style="font-style: italic; font-size: 11px">
                  {{ 'КП: ' + row?.lastCheckPoint.orderNumber + ' (' + row?.lastCheckPoint.name + ')' }}
                </span>
            </div>
            <div class="place-cell" *ngIf="row?.absolutePlace">
              <span>{{ 'Aбс: ' + row?.absolutePlace }}</span>
              <br>
              <span *ngFor="let group of row.groupPlaces" [ngStyle]="{'color': group.group.sex.color}">
                  {{ group.group.name + ': ' + group.place }}<br>
                </span>
            </div>
          </div>
        </div>
      </td>
    </ng-container>

    <!-- Header и Body -->
    <tr mat-header-row *matHeaderRowDef="dataTableBodyDef" class="sticky-header"></tr>
    <tr mat-row *matRowDef="let row; columns: dataTableBodyDef;"></tr>
  </table>
</div>
